name: "Attest Build Provenance"
description: "Generate provenance attestations for Docker images and other build artifacts"
author: "BoomchainLabs"
branding:
  color: "blue"
  icon: "lock"

inputs:
  subject-path:
    description: "Path(s) to artifact(s) (supports glob). Only one of 'subject-path', 'subject-digest', or 'subject-checksums' can be used."
    required: false
  subject-digest:
    description: "Digest of the subject (format: algorithm:hex_digest). Requires subject-name."
    required: false
  subject-name:
    description: "Name of the subject. Required when using 'subject-digest'."
    required: false
  subject-checksums:
    description: "Path to a checksums file containing digests and names."
    required: false
  predicate-type:
    description: "URI identifying the predicate type."
    required: true
  predicate:
    description: "JSON string of attestation predicate (max 16MB)."
    required: true
  predicate-path:
    description: "Path to file containing predicate (max 16MB). Only one of predicate or predicate-path can be used."
    required: false
  push-to-registry:
    description: "Push attestation to registry (requires subject-name & subject-digest)."
    default: false
  create-storage-record:
    description: "Create a storage record for the artifact (requires push-to-registry=true)."
    default: true
  show-summary:
    description: "Attach list of generated attestations to workflow summary."
    default: true
  github-token:
    description: "GitHub token for API requests"
    default: ${{ github.token }}

outputs:
  bundle-path:
    description: "Path to attestation bundle"
  attestation-id:
    description: "Attestation ID"
  attestation-url:
    description: "URL for attestation summary"
  storage-record-ids:
    description: "GitHub IDs for storage records"

runs:
  using: "composite"
  steps:
    - name: Attest
      id: attest
      uses: actions/attest@v4.0.0
      with:
        subject-path: ${{ inputs.subject-path }}
        subject-digest: ${{ inputs.subject-digest }}
        subject-name: ${{ inputs.subject-name }}
        subject-checksums: ${{ inputs.subject-checksums }}
        predicate-type: ${{ inputs.predicate-type }}
        predicate: ${{ inputs.predicate }}
        predicate-path: ${{ inputs.predicate-path }}
        push-to-registry: ${{ inputs.push-to-registry }}
        create-storage-record: ${{ inputs.create-storage-record }}
        show-summary: ${{ inputs.show-summary }}
        github-token: ${{ inputs.github-token }}
